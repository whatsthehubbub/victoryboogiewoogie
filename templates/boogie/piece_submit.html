{% extends "base.html" %}
{% load url from future %}
{% load crispy_forms_tags %}

{% block pagetitle %}Schrijven{% endblock pagetitle %}

{% block extrahead %}
<script type="text/javascript">

function checkSlide() {
    if ($('#id_genre').val() === 'Headline') {
    	$('#div_id_text').slideUp();
    	$('#charactercount').hide();
    } else {
    	$('#div_id_text').slideDown();
    	$('#charactercount').show();
    }
}

$(document).ready(function() {
    $('#id_genre').change(function() {
    	checkSlide();
    });

    checkSlide();

    $('#id_text').keyup(function() {
    	var max = 5000;
    	var len = $(this).val().length;
    	var box = $('#charactercount');
    	
    	if (len >= max) {
    		box.text('Je hebt de limiet bereikt.');
    		var firstString = $(this).val().slice(0, 5000);
    		$(this).val(firstString);
    		box.addClass("limit");
    	} else {
    		var remains = max - len;
    		box.text(remains + ' tekens over.');
    		box.removeClass("limit");
    	}
    });
});

</script>
{% endblock extrahead %}

{% block content %}
<div id="createitem" class="row">
	<div class="span8 offset2">
		
		<!-- TODO: Include character count. -->
		
		{% ifequal current_player.role 'PLAYER' %}
			{% if game.over %}
				<h2 class="text-center">Het spel is voorbij</h2>
				<p class="lead">Je kunt helaas niet meer meeschrijven. <a href="{% url 'post_game' %}">Lees hier de terugblik</a>.</p>
			{% else %}
				{% if form %}			
					<h2 class="text-center"><span class="sub-top">Schrijf een bijdrage over</span>{{ form.instance.topic.title }}{% if form.instance.character %} &amp; {{ form.instance.character }}{% endif %}</h2>
					
					{% if form.instance.rejection_reason %}
						<div class="alert">Feedback van de redactie: {{ form.instance.rejection_reason }}</div>
					{% endif %}
						
					<ul class="info clearfix">
						<li class="pull-left">Onderwerp</li>
						<li class="pull-right">
							{% if form.instance.topic.get_latest_piece %}
								Lees de laatste bijdrage over “{{ form.instance.topic.title }}” getiteld <a href="{% url 'piece_detail' form.instance.topic.get_latest_piece.id %}">{{ form.instance.topic.get_latest_piece.title|truncatechars:140 }}</a>
								{% else %}
								Er is nog niks geschreven over dit onderwerp. <em>Carte blanche!</em>
							{% endif %}
						</li>
					</ul>

					{% if form.instance.character %}
						<ul class="info clearfix">
							<li class="pull-left">Personage</li>
							<li class="pull-right">Lees de laatste bijdrage over “{{ form.instance.character }}” getiteld <a href="">{{ form.instance.character.get_latest_piece.title|truncatechars:140 }}</a></li>
						</ul>
					{% endif %}

					<ul class="info clearfix">
						<li class="pull-left">Deadline</li>
						<li class="pull-right">{{ form.instance.deadline|timeuntil }}</li>
					</ul>
					<ul class="info clearfix">
						<li class="pull-left">Aantal bijdragen deze ronde</li>
						<li class="pull-right"><span class="label">{{ form.instance.topic.piece_count }}</span></li><!-- TODO: Hook this up to topic rank. -->
					</ul>
					
					{% crispy form %}
					
					<div class="well">Na inzending buigt de redactie zich over je bijdrage. Ze kijkt naar de kwaliteit, en of je rekening hebt gehouden met wat er al is geschreven. Je krijgt een e-mail zodra je bijdrage is goedgekeurd of als ze wil dat je het aanpast, of als de redactie heeft besloten hem af te wijzen.</div>
					
				{% else %}
					<h2 class="text-center">Je mag op dit moment niks schrijven.</h2>
				{% endif %}
			{% endif %}
		{% endifequal %}		
	</div>
</div>
{% endblock %}