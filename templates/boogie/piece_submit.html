{% extends "base.html" %}
{% load url from future %}

{% block pagetitle %}Schrijven{% endblock pagetitle %}

{% block extrahead %}
	<script type="text/javascript">

	$(document).ready(function() {
		$('#id_genre').change(function() {

			if ($('#id_genre').val() === 'Headline') {
				$('#id_text').parent().slideUp();
			} else {
				$('#id_text').parent().slideDown();
			}
		});
	});

	</script>
{% endblock extrahead %}


{% block bodyid %}piece_submit{% endblock %}

{% block content %}
<div id="createitem" class="row">
	<div class="span8 offset2">
		
		<!-- TODO: Include character count. -->
		
		{% if form %}
			{% ifequal current_player.role 'WRITER' %}
				<h2 class="text-center">Schrijf een gebeurtenis</h2>
			{% endifequal %}
			
			{% ifequal current_player.role 'PLAYER' %}
				<h2 class="text-center">Schrijf een bijdrage <span class="sub">over “{{ form.instance.topic.title }}”</span></h2>
				
			{% if form.instance.rejection_reason %}
				<div class="alert">Feedback van de redactie: {{ form.instance.rejection_reason }}</div>
			{% endif %}
							
				<ul class="info clearfix">
					<li class="pull-left">Info</li>
					<li class="pull-right">
						{% if form.instance.topic.get_latest_piece %}
							Lees de <a href="{% url 'piece_detail' form.instance.topic.get_latest_piece.id %}">laatste bijdrage</a> over “{{ form.instance.topic.title }}” of bekijk <a href="{% url 'topic_detail' form.instance.topic.id form.instance.topic.slug %}">alle bijdragen</a> over dit onderwerp.
							{% else %}
							Er is nog niks geschreven over dit onderwerp. <em>Carte blanche!</em>
						{% endif %}
					</li>
				</ul>
				<ul class="info clearfix">
					<li class="pull-left">Deadline</li>
					<li class="pull-right">{{ form.instance.deadline|timeuntil }}</li>
				</ul>
				<ul class="info clearfix">
					<li class="pull-left">Voortgang tot gebeurtenis</li>
					<li class="pull-right">{{ form.instance.topic.progress }}%</li>
				</ul>
			{% endifequal %}
			
			<form action="{% url 'piece_submit' %}" method="post">
				{% csrf_token %}
				
				{% for field in form %}
				<div class="{{ field.html_name }} clearfix">{{ field.label_tag }}{{ field }}</div>
				{% endfor %}

				<p id="char_counter"></p>

				<input type="submit" value="Verzenden" class="btn pull-right">
			</form>

			<div class="well">Na inzending buigt de redactie zich over je bijdrage. Ze kijkt naar de kwaliteit, en of je rekening hebt gehouden met wat er al is geschreven. Je krijgt een e-mail zodra je bijdrage is goedgekeurd of als ze wil dat je het aanpast, of als de redactie heeft besloten hem af te wijzen.</div>

		{% else %}
			<h2 class="text-center">Je mag op dit moment niks schrijven.</h2>
		{% endif %}
		
	</div>
</div>
{% endblock %}